/* Copyright (c) 2013-2014, Null McNull https://github.com/McNull, LICENSE: MIT */
angular.module("blockUI",["templates-angularBlockUI"]),angular.module("blockUI").config(["$provide","$httpProvider",function(a,b){a.decorator("$exceptionHandler",["$delegate","$injector",function(a,b){var c,d;return function(e,f){d=d||b.get("blockUIConfig"),d.resetOnException&&(c=c||b.get("blockUI"),c.instances.reset()),a(e,f)}}]),b.interceptors.push("blockUIHttpInterceptor")}]),angular.module("blockUI").run(["$document",function(a){a.find("body").append('<div block-ui="main"></div>')}]),angular.module("blockUI").provider("blockUIConfig",function(){var a={templateUrl:"angular-block-ui/angular-block-ui.tmpl.html",delay:250,message:"Loading ...",autoBlock:!0,resetOnException:!0,requestFilter:angular.noop};this.templateUrl=function(b){a.templateUrl=b},this.template=function(b){a.template=b},this.delay=function(b){a.delay=b},this.message=function(b){a.message=b},this.autoBlock=function(b){a.autoBlock=b},this.resetOnException=function(b){a.resetOnException=b},this.requestFilter=function(b){a.requestFilter=b},this.$get=function(){return a}}),angular.module("blockUI").directive("blockUi",["blockUI","blockUIConfig","blockUiLinkFn",function(a,b,c){return{scope:!0,restrict:"A",templateUrl:b.template?void 0:b.templateUrl,template:b.template,link:c}}]).factory("blockUiLinkFn",["blockUI","blockUIUtils",function(a,b){return function(c,d,e){var f=d.parent();if(f.length){var g=a;if("BODY"===f[0].tagName)var h=c.$on("$viewContentLoaded",function(){h(),c.$on("$locationChangeStart",function(a){c.state.blockCount>0&&a.preventDefault()})});else{f.css("position","relative");var i=e.blockUi?e.blockUi:c.$id;g=a.instances.get(i),g.addRef();var j=e.blockUiPattern;if(j){var k=b.buildRegExp(j);g.pattern(k)}c.$on("$destroy",function(){g.release()})}d.addClass("block-ui"),d.data("block-ui",g),c.state=g.state()}}}]),angular.module("blockUI").factory("blockUIHttpInterceptor",["$q","$injector","blockUIConfig",function(a,b,c){function d(){f=f||b.get("blockUI")}function e(b){return c.autoBlock&&(d(),f.stop()),a.reject(b)}var f;return{request:function(a){return c.autoBlock&&(c.requestFilter(a)===!1?a.$_noBlock=!0:(d(),a.$_blocks=f.instances.locate(a),a.$_blocks.start())),a},requestError:e,response:function(a){var b=a.config;return c.autoBlock&&!b.$_noBlock&&b.$_blocks&&(d(),b.$_blocks.stop()),a},responseError:e}}]),angular.module("blockUI").factory("blockUI",["blockUIConfig","$timeout","blockUIUtils",function(a,b,c){function d(c){var d,e=this,g={id:c,blockCount:0,message:a.message,blocking:!1},h=[];this._refs=0,this.start=function(c){g.message=c||a.message,g.blockCount++,d||(d=b(function(){d=null,g.blocking=!0},a.delay))},this._cancelStartTimeout=function(){d&&(b.cancel(d),d=null)},this.stop=function(){g.blockCount=Math.max(0,--g.blockCount),0===g.blockCount&&this.reset(!0)},this.message=function(a){g.message=a},this.pattern=function(a){return void 0!==a&&(e._pattern=a),e._pattern},this.reset=function(a){e._cancelStartTimeout(),g.blockCount=0,g.blocking=!1;try{a&&angular.forEach(h,function(a){a()})}finally{h.length=0}},this.done=function(a){h.push(a)},this.state=function(){return g},this.addRef=function(){e._refs+=1},this.release=function(){--e._refs<=0&&f.instances._destroy(e)}}var e=[];e.get=function(a){var b=e[a];return b||(b=e[a]=new d(a),e.push(b)),b},e._destroy=function(a){if(angular.isString(a)&&(a=e[a]),a){a.reset(),delete e[a.state().id];for(var b=e.length;--b;)if(e[b]===a){e.splice(b,1);break}}},e.locate=function(a){var b=[];c.forEachFnHook(b,"start"),c.forEachFnHook(b,"stop");for(var d=e.length;d--;){var g=e[d],h=g._pattern;h&&h.test(a.url)&&b.push(g)}return 0===b.length&&b.push(f),b},c.forEachFnHook(e,"reset");var f=e.get("main");return f.addRef(),f.instances=e,f}]),angular.module("blockUI").factory("blockUIUtils",function(){var a={buildRegExp:function(a){var b,c=a.match(/^\/(.*)\/([gim]*)$/);if(!c)throw Error("Incorrect regular expression format: "+a);return b=new RegExp(c[1],c[2])},forEachFn:function(a,b,c){for(var d=a.length;d--;){var e=a[d];e[b].apply(e,c)}},forEachFnHook:function(b,c){b[c]=function(){a.forEachFn(this,c,arguments)}}};return a}),angular.module("templates-angularBlockUI",["angular-block-ui/angular-block-ui.tmpl.html"]),angular.module("angular-block-ui/angular-block-ui.tmpl.html",[]).run(["$templateCache",function(a){a.put("angular-block-ui/angular-block-ui.tmpl.html",'<div ng-show="state.blockCount > 0" class="block-ui-overlay" ng-class="{ \'block-ui-visible\': state.blocking }"></div>\n<div ng-show="state.blocking" class="block-ui-message-container">\n  <div class="block-ui-message">{{ state.message }}</div>  \n</div>\n')}]);